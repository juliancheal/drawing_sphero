Cylon = require('cylon')

Cylon.robot
  connections: [{ name: 'sphero', adaptor: 'sphero', port: '/dev/rfcomm1'},
  			    { name: 'keyboard', adaptor: 'keyboard' }]

  devices: [{ name: 'keyboard', driver: 'keyboard', connection: 'keyboard' },
  			{ name: 'sphero', driver: 'sphero', connection: 'sphero'}]

  running: 0

  work: (my) ->

    my.keyboard.on 'up', (key) ->
      console.log "Forward!"
      my.sphero.roll(60, 0)

    my.keyboard.on 'down', (key) ->
      console.log "back!"
      my.sphero.roll(60, 180)

    my.keyboard.on 'left', (key) ->
      console.log "LEFT!"
      my.sphero.roll(60, 270)

    my.keyboard.on 'right', (key) ->
      console.log "RIGHT!"
      my.sphero.roll(60, 90)

    my.keyboard.on 'space', (key) ->
      console.log "stop!"
      my.sphero.stop()

      if my.running is 0
        my.running = 1
        my.sphero.finishCalibration()
      else
        my.running = 0
        my.sphero.startCalibration()

Cylon.start()
